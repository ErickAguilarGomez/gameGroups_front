import{a as Ee,r as Ge,_ as Fe,v as Ne}from"./usePreloader-Bmit-4CY.js";import{u as Te,b as Ae,c as Oe,d as Le,_ as ie,a as Se}from"./useShowHide-717t6y_D-C-V7aJWO.js";import{_ as He,I as je,u as qe}from"./cloudinaryService-dMxLN9ju.js";import{l as le,z as T,f as C,w as s,b as a,D as Re,E as Be,h as E,C as We,o,n as Ie,r as w,m as Ce,c as d,g as z,a as e,d as f,t as U,_ as ue,G as Xe,H as Je,v as Ke,u as De,A as se,j as S,p as ae,q as $e,F as oe,e as ve,y as xe,I as te,J as Qe,K as Ye,L as Ze,M as ze,B as _e}from"./index-dPwBrLZS.js";import{_ as fe}from"./index-BDkr-YqK-BHP480si.js";import{a as ea,_ as aa}from"./BForm.vue_vue_type_script_setup_true_lang-u44ElAm9-D0U4uLNH.js";import{_ as Me,a as oa,c as ta}from"./BFormInput.vue_vue_type_script_setup_true_lang-D3z3jxbI-B1H0soc1.js";import{_ as Ue,a as sa,b as la}from"./BInputGroupText.vue_vue_type_script_setup_true_lang-BBN5F0A4-CfGZnj3Y.js";import{C as na}from"./CountrySelect-C9B5ds5i.js";const ra=le({__name:"BBadge",props:{dotIndicator:{type:Boolean,default:!1},pill:{type:Boolean,default:!1},placement:{default:void 0},tag:{default:"span"},active:{type:Boolean,default:void 0},activeClass:{default:void 0},disabled:{type:Boolean,default:void 0},exactActiveClass:{default:void 0},href:{default:void 0},icon:{type:Boolean,default:void 0},noRel:{type:Boolean},opacity:{default:void 0},opacityHover:{default:void 0},prefetch:{type:Boolean},prefetchOn:{},noPrefetch:{type:Boolean},prefetchedClass:{},rel:{default:void 0},replace:{type:Boolean,default:void 0},routerComponentName:{default:void 0},stretched:{type:Boolean,default:!1},target:{default:void 0},to:{default:void 0},underlineOffset:{default:void 0},underlineOffsetHover:{default:void 0},underlineOpacity:{default:void 0},underlineOpacityHover:{default:void 0},underlineVariant:{default:void 0},variant:{default:"secondary"},bgVariant:{default:null},textVariant:{default:null}},setup(V){const l=Te(V,"BBadge"),{computedLink:c,computedLinkProps:u}=Ae(l,["active","activeClass","append","disabled","href","rel","replace","routerComponentName","target","to","opacity","opacityHover","underlineVariant","underlineOffset","underlineOffsetHover","underlineOpacity","underlineOpacityHover","icon"]),h=T(()=>c.value?Oe:l.tag),y=T(()=>{const p=l.placement??(l.dotIndicator?"top-end":void 0);return["position-absolute","translate-middle",{"start-0 top-0":p==="top-start","start-0 top-50":p==="start","start-0 top-100":p==="bottom-start","start-50 top-0":p==="top","start-50 top-100":p==="bottom","start-100 top-0":p==="top-end","start-100 top-50":p==="end","start-100 top-100":p==="bottom-end"}]}),t=Le(l),I=T(()=>[t.value,l.placement!==void 0||l.dotIndicator===!0?y.value:void 0,{active:l.active,disabled:l.disabled,"rounded-pill":l.pill,"p-2 border border-light rounded-circle":l.dotIndicator,"text-decoration-none":c.value}]);return(p,v)=>(o(),C(We(h.value),Be({class:["badge",I.value]},E(u)),{default:s(()=>[a(He,Be({skip:E(l).dotIndicator!==!0,tag:"span"},E(l).dotIndicator?{class:"visually-hidden"}:{}),{default:s(()=>[Re(p.$slots,"default")]),_:3},16,["skip"])]),_:3},16,["class"]))}}),Pe={async getAllGroups(){return(await Ie.get("/api/groups/all-groups")).data},async showUserDetail(V){return(await Ie.get(`/api/groups/user-detail/${V}`)).data}},ia={key:0,class:"user-detail-container"},ua={class:"avatar-section"},da={class:"avatar-wrapper"},ca=["src","alt"],pa={key:1,class:"avatar-placeholder"},ma={class:"user-name"},_a={class:"user-email"},va={class:"info-grid"},fa={class:"info-card"},ga={class:"info-icon"},ha={class:"info-content"},ya={class:"info-value"},ba={class:"info-card"},ka={class:"info-icon"},wa={class:"info-content"},Ia={key:0,class:"social-info"},$a=["src","alt"],Ca={class:"info-value"},Ua={key:1,class:"info-value"},Va={class:"info-card"},Ba={class:"info-icon"},za={class:"info-content"},Ea={class:"info-value"},Ga={class:"info-card"},Sa={class:"info-icon"},Da=["src","alt"],xa={class:"info-content"},Ma={class:"info-value"},Pa={key:0,class:"ban-section"},Fa={class:"ban-header"},Na={class:"ban-content"},Ta={class:"ban-reason"},Aa={class:"ban-date"},Oa=le({__name:"UserDetailModal",props:{modelValue:{type:Boolean},user:{}},emits:["update:modelValue","close"],setup(V,{emit:G}){const{showUserDetail:l}=Pe,c=w(null),u=V,h=G,y=T({get:()=>u.modelValue,set:g=>h("update:modelValue",g)});Ce(()=>{I()});const t=()=>{y.value=!1,h("close")},I=async()=>{try{Ee();const g=await l(u.user?.id);c.value=g}catch(g){console.log(g)}finally{Ge()}},p=g=>g?new Date(g).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"No disponible";function v(g){return g?`https://flagcdn.com/w40/${g.toString().slice(0,2).toLowerCase()}.png`:""}return(g,B)=>{const x=f("IconUser"),b=f("IconCake"),P=f("IconBrandInstagram"),A=f("IconCalendarEvent"),F=f("IconGlobe"),O=f("IconAlertTriangle"),L=fe;return o(),C(L,{modelValue:y.value,"onUpdate:modelValue":B[0]||(B[0]=H=>y.value=H),title:"Detalle del Usuario",size:"lg",centered:"","no-footer":"","header-bg-variant":"dark","header-text-variant":"light",onHidden:t},{default:s(()=>[c.value?(o(),d("div",ia,[e("div",ua,[e("div",da,[c.value.photo_url&&c.value.photo_status==="approved"?(o(),d("img",{key:0,src:c.value.photo_url,alt:c.value.name,class:"user-avatar"},null,8,ca)):(o(),d("div",pa,[a(x,{size:64})]))]),e("h4",ma,U(c.value.name),1),e("p",_a,U(c.value.email),1)]),e("div",va,[e("div",fa,[e("div",ga,[a(b,{size:24})]),e("div",ha,[B[1]||(B[1]=e("span",{class:"info-label"},"Fecha de Nacimiento",-1)),e("span",ya,U(p(c.value.birthdate)||"No especificada"),1)])]),e("div",ba,[e("div",ka,[a(P,{size:24})]),e("div",wa,[B[2]||(B[2]=e("span",{class:"info-label"},"Red Social",-1)),c.value.social_network_name&&c.value.social_network_logo_url?(o(),d("div",Ia,[e("img",{src:c.value.social_network_logo_url,alt:c.value.social_network_name,class:"social-logo"},null,8,$a),e("span",Ca,U(c.value.nickname||"-"),1)])):(o(),d("span",Ua,"No especificada"))])]),e("div",Va,[e("div",Ba,[a(A,{size:24})]),e("div",za,[B[3]||(B[3]=e("span",{class:"info-label"},"Fecha de Registro",-1)),e("span",Ea,U(p(c.value.created_at)),1)])]),e("div",Ga,[e("div",Sa,[c.value.country_slug?(o(),d("img",{key:0,src:v(c.value.country_slug),alt:c.value.country||"Bandera",class:"country-flag"},null,8,Da)):(o(),C(F,{key:1,size:24}))]),e("div",xa,[B[4]||(B[4]=e("span",{class:"info-label"},"País",-1)),e("span",Ma,U(c.value.country||"-"),1)])])]),c.value?.banned_at?(o(),d("div",Pa,[e("div",Fa,[a(O,{size:24,class:"ban-icon"}),B[5]||(B[5]=e("h5",{class:"ban-title"},"Usuario Baneado",-1))]),e("div",Na,[e("p",Ta,U(c.value?.ban_reason||"Sin motivo especificado"),1),e("p",Aa," Baneado el: "+U(p(c.value?.banned_at)),1)])])):z("",!0)])):z("",!0)]),_:1},8,["modelValue"])}}}),La=ue(Oa,[["__scopeId","data-v-269a6067"]]),Ha=Xe("user",{state:()=>({loading:!1,uploading:!1,error:null}),getters:{isLoading:V=>V.loading,isUploading:V=>V.uploading,currentError:V=>V.error},actions:{async uploadPhoto(V){this.uploading=!0,this.error=null;try{if(!V.type.startsWith("image/"))throw new Error("Solo se permiten archivos de imagen");if(V.size>5*1024*1024)throw new Error("La imagen no debe superar los 5MB");const G=await Ke.getSignature("user_photos"),{signature:l,timestamp:c,api_key:u,cloud_name:h,folder:y}=G.data,t=new FormData;t.append("file",V),t.append("api_key",u),t.append("timestamp",c.toString()),t.append("signature",l),t.append("folder",y);const I=await fetch(`https://api.cloudinary.com/v1_1/${h}/image/upload`,{method:"POST",body:t});if(!I.ok)throw new Error("Error al subir la imagen");return(await I.json()).secure_url}catch(G){return this.error=G.message||"Error al subir la imagen a Cloudinary",console.error("Cloudinary upload error:",G),null}finally{this.uploading=!1}},async updateProfile(V){this.loading=!0,this.error=null;try{return{success:!0,user:(await Je.updateProfile(V)).data}}catch(G){const l=G.response?.data?.message||"Error al actualizar el perfil";return this.error=l,{success:!1,error:l}}finally{this.loading=!1}},clearError(){this.error=null},reset(){this.loading=!1,this.uploading=!1,this.error=null}}}),ja={class:"modal-content-wrapper"},qa={class:"text-center mb-4"},Ra={class:"edit-icon mb-3"},Wa={class:"text-center mb-4"},Xa={class:"photo-preview mx-auto mb-3"},Ja=["src"],Ka={key:1,class:"preview-placeholder"},Qa={class:"d-flex gap-2 justify-content-center"},Ya={class:"social-network-selector"},Za=["onClick"],eo=["src","alt"],ao={class:"social-name"},oo={class:"d-flex gap-2"},to=le({__name:"ProfileEditModal",props:{modelValue:{type:Boolean}},emits:["update:modelValue","updated"],setup(V,{emit:G}){const l=V,c=G,u=Ha(),h=De(),y=T({get:()=>l.modelValue,set:_=>c("update:modelValue",_)}),t=w({name:"",email:"",social_network_id:null,nickname:"",birthdate:"",country:null,country_slug:null,password:"",password_confirmation:""}),I=w(null),p=w(null),v=w(null),g=w([]),B=w(null),x=w(!1),b=w(!1);Ce(async()=>{await P(),A()});async function P(){try{const _=await Ie.get("/api/social-networks");g.value=_.data}catch(_){console.error("Error al cargar redes sociales:",_)}}function A(){const _=h.currentUser;_&&(t.value={name:_.name||"",email:_.email||"",social_network_id:_.social_network_id||null,nickname:_.nickname||"",birthdate:_.birthdate?_.birthdate.split("T")[0]:"",country:_.country||null,country_slug:_.country_slug||null,password:"",password_confirmation:""},I.value=_.photo_url||null,p.value=null)}se(()=>h.currentUser,()=>{A()},{immediate:!0}),se(()=>l.modelValue,_=>{_&&A()});function F(_){t.value.social_network_id===_?(t.value.social_network_id=null,t.value.nickname=""):t.value.social_network_id=_}function O(){return g.value.find(i=>i.id===t.value.social_network_id)?.name||"la red social"}function L(){v.value?.click()}async function H(_){const Q=_.target.files?.[0];if(!Q)return;const J=await u.uploadPhoto(Q);J&&(p.value=J,I.value=J)}function M(){p.value=null,I.value=h.currentUser?.photo_url||null,v.value&&(v.value.value="")}async function X(){if(B.value=null,u.clearError(),t.value.password){if(t.value.password.length<8){u.error="La contraseña debe tener al menos 8 caracteres";return}if(t.value.password!==t.value.password_confirmation){u.error="Las contraseñas no coinciden";return}}try{const _={name:t.value.name,nickname:t.value.nickname||null,birthdate:t.value.birthdate||null,social_network_id:t.value.social_network_id,country:t.value.country,country_slug:t.value.country_slug};p.value&&(_.photo_url=p.value),t.value.password&&(_.password=t.value.password,_.password_confirmation=t.value.password_confirmation),(await u.updateProfile(_)).success&&(await h.fetchUser(),B.value="✅ Perfil actualizado correctamente",c("updated"),setTimeout(()=>{y.value=!1},1500))}catch(_){console.error("Error al actualizar perfil:",_)}}function j(){I.value=h.currentUser?.photo_url||null,p.value=null,B.value=null,u.clearError(),v.value&&(v.value.value="")}return(_,i)=>{const Q=f("IconUserEdit"),J=f("IconCamera"),ne=Se,ge=f("IconUpload"),K=ie,he=f("IconTrash"),ye=f("IconUser"),q=la,R=Me,W=sa,m=Ue,r=f("IconMail"),$=oa,N=f("IconCalendar"),de=f("IconAt"),ce=f("IconLock"),Y=f("IconEye"),pe=f("IconEyeOff"),Z=f("IconAlertCircle"),ee=ea,me=f("IconCheck"),be=f("IconDeviceFloppy"),ke=aa,we=fe;return o(),C(we,{modelValue:y.value,"onUpdate:modelValue":i[11]||(i[11]=k=>y.value=k),centered:"",size:"lg","hide-header":"","no-footer":"","header-class":"b-0","body-class":"p-0","max-height":"50vh",scrollable:"",onHidden:j},{default:s(()=>[e("div",ja,[e("div",qa,[e("div",Ra,[a(Q,{size:60,"stroke-width":1.5})]),i[12]||(i[12]=e("h2",{class:"fw-bold"},"Editar Perfil",-1)),i[13]||(i[13]=e("p",{class:"text-muted"},"Actualiza tu información personal",-1))]),a(ke,{onSubmit:ve(X,["prevent"])},{default:s(()=>[e("div",Wa,[e("div",Xa,[I.value?(o(),d("img",{key:0,src:I.value,alt:"Preview",class:"preview-image"},null,8,Ja)):(o(),d("div",Ka,[a(J,{size:40}),i[14]||(i[14]=e("p",{class:"mb-0 mt-2 small text-muted"},"Sin foto",-1))]))]),e("input",{type:"file",ref_key:"fileInput",ref:v,onChange:H,accept:"image/*",class:"d-none"},null,544),e("div",Qa,[a(K,{variant:"outline-primary",size:"sm",onClick:L,disabled:E(u).isUploading},{default:s(()=>[E(u).isUploading?(o(),C(ne,{key:0,small:"",class:"me-2"})):z("",!0),E(u).isUploading?z("",!0):(o(),C(ge,{key:1,size:18,class:"me-1"})),S(" "+U(E(u).isUploading?"Subiendo...":"Seleccionar Foto"),1)]),_:1},8,["disabled"]),I.value&&I.value!==E(h).currentUser?.photo_url?(o(),C(K,{key:0,variant:"outline-danger",size:"sm",onClick:M},{default:s(()=>[a(he,{size:18,class:"me-1"}),i[15]||(i[15]=S(" Quitar ",-1))]),_:1})):z("",!0)])]),a(m,{label:"Nombre Completo","label-for":"name",class:"mb-3"},{default:s(()=>[a(W,null,{prepend:s(()=>[a(q,null,{default:s(()=>[a(ye,{size:20})]),_:1})]),default:s(()=>[a(R,{id:"name",modelValue:t.value.name,"onUpdate:modelValue":i[0]||(i[0]=k=>t.value.name=k),type:"text",placeholder:"Tu nombre completo",required:""},null,8,["modelValue"])]),_:1})]),_:1}),a(m,{label:"Correo Electrónico","label-for":"email",class:"mb-3"},{default:s(()=>[a(W,null,{prepend:s(()=>[a(q,null,{default:s(()=>[a(r,{size:20})]),_:1})]),default:s(()=>[a(R,{id:"email",modelValue:t.value.email,"onUpdate:modelValue":i[1]||(i[1]=k=>t.value.email=k),type:"email",disabled:""},null,8,["modelValue"])]),_:1}),a($,null,{default:s(()=>[...i[16]||(i[16]=[S("El correo electrónico no se puede modificar",-1)])]),_:1})]),_:1}),a(m,{label:"Fecha de Nacimiento","label-for":"birthdate",class:"mb-3"},{default:s(()=>[a(W,null,{prepend:s(()=>[a(q,null,{default:s(()=>[a(N,{size:20})]),_:1})]),default:s(()=>[a(R,{id:"birthdate",modelValue:t.value.birthdate,"onUpdate:modelValue":i[2]||(i[2]=k=>t.value.birthdate=k),type:"date"},null,8,["modelValue"])]),_:1})]),_:1}),a(m,{label:"Red Social (Opcional)","label-for":"social_network",class:"mb-3"},{default:s(()=>[e("div",Ya,[(o(!0),d(oe,null,ae(g.value,k=>(o(),d("div",{key:k.id,class:$e(["social-option",{active:t.value.social_network_id===k.id}]),onClick:re=>F(k.id)},[e("img",{src:k.logo_url,alt:k.name,class:"social-icon"},null,8,eo),e("span",ao,U(k.name),1)],10,Za))),128))]),a($,null,{default:s(()=>[...i[17]||(i[17]=[S("Selecciona dónde pueden encontrarte",-1)])]),_:1})]),_:1}),t.value.social_network_id?(o(),C(m,{key:0,label:"Nickname","label-for":"nickname",class:"mb-3"},{default:s(()=>[a(W,null,{prepend:s(()=>[a(q,null,{default:s(()=>[a(de,{size:20})]),_:1})]),default:s(()=>[a(R,{id:"nickname",modelValue:t.value.nickname,"onUpdate:modelValue":i[3]||(i[3]=k=>t.value.nickname=k),type:"text",placeholder:"Tu usuario en la red social",required:!!t.value.social_network_id},null,8,["modelValue","required"])]),_:1}),a($,null,{default:s(()=>[S(" Tu nickname en "+U(O()),1)]),_:1})]),_:1})):z("",!0),a(m,{label:"País","label-for":"country",class:"mb-3"},{default:s(()=>[a(na,{modelValue:t.value.country,"onUpdate:modelValue":i[4]||(i[4]=k=>t.value.country=k),modelSlug:t.value.country_slug,"onUpdate:modelSlug":i[5]||(i[5]=k=>t.value.country_slug=k)},null,8,["modelValue","modelSlug"])]),_:1}),a(m,{label:"Nueva Contraseña (Opcional)","label-for":"password",class:"mb-3"},{default:s(()=>[a(W,null,{prepend:s(()=>[a(q,null,{default:s(()=>[a(ce,{size:20})]),_:1})]),append:s(()=>[a(K,{variant:"outline-secondary",onClick:i[7]||(i[7]=k=>x.value=!x.value)},{default:s(()=>[x.value?(o(),C(pe,{key:1,size:20})):(o(),C(Y,{key:0,size:20}))]),_:1})]),default:s(()=>[a(R,{id:"password",modelValue:t.value.password,"onUpdate:modelValue":i[6]||(i[6]=k=>t.value.password=k),type:x.value?"text":"password",placeholder:"Dejar en blanco para no cambiar",minlength:"8"},null,8,["modelValue","type"])]),_:1}),a($,null,{default:s(()=>[...i[18]||(i[18]=[S("Mínimo 8 caracteres. Dejar vacío para mantener la actual",-1)])]),_:1})]),_:1}),t.value.password?(o(),C(m,{key:1,label:"Confirmar Nueva Contraseña","label-for":"password_confirmation",class:"mb-3"},{default:s(()=>[a(W,null,{prepend:s(()=>[a(q,null,{default:s(()=>[a(ce,{size:20})]),_:1})]),append:s(()=>[a(K,{variant:"outline-secondary",onClick:i[9]||(i[9]=k=>b.value=!b.value)},{default:s(()=>[b.value?(o(),C(pe,{key:1,size:20})):(o(),C(Y,{key:0,size:20}))]),_:1})]),default:s(()=>[a(R,{id:"password_confirmation",modelValue:t.value.password_confirmation,"onUpdate:modelValue":i[8]||(i[8]=k=>t.value.password_confirmation=k),type:b.value?"text":"password",placeholder:"Confirma tu nueva contraseña",minlength:"8"},null,8,["modelValue","type"])]),_:1})]),_:1})):z("",!0),E(u).currentError?(o(),C(ee,{key:2,variant:"danger",show:"",dismissible:"",onDismissed:i[10]||(i[10]=k=>E(u).clearError()),class:"mb-3"},{default:s(()=>[a(Z,{size:20,class:"me-2"}),S(" "+U(E(u).currentError),1)]),_:1})):z("",!0),B.value?(o(),C(ee,{key:3,variant:"success",show:"",class:"mb-3"},{default:s(()=>[a(me,{size:20,class:"me-2"}),S(" "+U(B.value),1)]),_:1})):z("",!0),e("div",oo,[a(K,{type:"submit",variant:"primary",size:"lg",class:"flex-fill",disabled:E(u).isLoading||E(u).isUploading},{default:s(()=>[E(u).isLoading?(o(),C(ne,{key:0,small:"",class:"me-2"})):z("",!0),E(u).isLoading?z("",!0):(o(),C(be,{key:1,size:20,class:"me-2"})),S(" "+U(E(u).isLoading?"Guardando...":"Guardar Cambios"),1)]),_:1},8,["disabled"])])]),_:1})])]),_:1},8,["modelValue"])}}}),so=ue(to,[["__scopeId","data-v-b773530a"]]),lo={class:"modal-footer-custom"},no=le({__name:"GroupFormModal",props:{modelValue:{type:Boolean,required:!0},initialGroup:{type:Object,default:null}},emits:["update:modelValue","saved"],setup(V,{emit:G}){const l=V,c=G,{toast:u}=xe(),h=w(!!l.modelValue);se(()=>l.modelValue,b=>h.value=!!b),se(h,b=>c("update:modelValue",b));const y=w({name:"",group_img_url:""}),t=w(null),I=w(null),p=w(!1),v=T(()=>!!l.initialGroup);se(()=>l.initialGroup,b=>{b?(y.value={name:b.name||"",group_img_url:b.group_img_url||""},I.value=b.group_img_url||null,t.value=null):(y.value={name:"",group_img_url:""},I.value=null,t.value=null)},{immediate:!0});function g(b){t.value=b}function B(b){I.value=b,b&&(y.value.group_img_url="")}async function x(){try{if(t.value instanceof File){p.value=!0;try{const b=await qe(t.value);y.value.group_img_url=b}finally{p.value=!1}}v.value&&l.initialGroup&&l.initialGroup.id?(await te.update(l.initialGroup.id,y.value),u("Grupo actualizado","success")):(await te.create(y.value),u("Grupo creado","success")),c("saved"),h.value=!1}catch(b){u(b?.message||"Error al guardar grupo","error")}}return(b,P)=>{const A=Me,F=Ue,O=Se,L=f("IconDeviceFloppy"),H=ie,M=fe;return o(),C(M,{modelValue:h.value,"onUpdate:modelValue":P[1]||(P[1]=X=>h.value=X),title:v.value?"Editar Grupo":"Crear Grupo",size:"md",centered:"","header-bg-variant":"dark","header-text-variant":"light","no-footer":""},{default:s(()=>[a(F,{label:"Nombre del Grupo","label-for":"group-name"},{default:s(()=>[a(A,{id:"group-name",modelValue:y.value.name,"onUpdate:modelValue":P[0]||(P[0]=X=>y.value.name=X),placeholder:"Ej: Equipo Alpha"},null,8,["modelValue"])]),_:1}),a(F,{label:"Imagen del Grupo","label-for":"group-image"},{default:s(()=>[a(je,{"initial-preview":I.value||y.value.group_img_url,disabled:p.value,"onUpdate:file":g,"onUpdate:preview":B},null,8,["initial-preview","disabled"])]),_:1}),e("div",lo,[a(H,{variant:"primary",onClick:x,disabled:p.value},{default:s(()=>[p.value?(o(),C(O,{key:0,small:"",class:"me-1"})):(o(),C(L,{key:1,size:20,class:"me-1"})),S(" "+U(v.value?"Actualizar":"Crear"),1)]),_:1},8,["disabled"])])]),_:1},8,["modelValue","title"])}}}),ro=ue(no,[["__scopeId","data-v-400d29f3"]]),io={class:"ban-modal-content"},uo={class:"warning-section"},co={class:"warning-text"},po={class:"modal-footer-actions"},mo=le({__name:"BanUserModal",props:{modelValue:{type:Boolean},user:{},groupId:{}},emits:["update:modelValue","ban"],setup(V,{emit:G}){const l=V,c=G,u=w(""),h=T(()=>u.value.trim().length>0),y=T({get:()=>l.modelValue,set:p=>c("update:modelValue",p)});se(()=>l.modelValue,p=>{p&&(u.value="")});const t=()=>{c("update:modelValue",!1),u.value=""},I=()=>{l.user&&l.groupId&&u.value.trim()&&(c("ban",{userId:l.user.id,groupId:l.groupId,banReason:u.value.trim()}),t())};return(p,v)=>(o(),C(E(fe),{modelValue:y.value,"onUpdate:modelValue":v[1]||(v[1]=g=>y.value=g),title:"Banear Usuario del Grupo",centered:"","header-bg-variant":"danger","header-text-variant":"light",onHidden:t},{footer:s(()=>[e("div",po,[a(E(ie),{variant:"secondary",onClick:t},{default:s(()=>[...v[6]||(v[6]=[S(" Cancelar ",-1)])]),_:1}),a(E(ie),{variant:"danger",onClick:I,disabled:!h.value},{default:s(()=>[a(E(Ye),{size:20}),v[7]||(v[7]=S(" Banear Usuario ",-1))]),_:1},8,["disabled"])])]),default:s(()=>[e("div",io,[e("div",uo,[a(E(Qe),{size:48,class:"warning-icon"}),e("p",co,[v[2]||(v[2]=S(" ¿Estás seguro de que deseas banear a ",-1)),e("strong",null,U(V.user?.name),1),v[3]||(v[3]=S("? ",-1))]),v[4]||(v[4]=e("p",{class:"warning-subtext"}," El usuario será removido del grupo y no podrá ser asignado nuevamente hasta que sea desbaneado. ",-1))]),a(E(Ue),{label:"Motivo del Baneo *","label-for":"ban-reason"},{default:s(()=>[a(E(Fe),{id:"ban-reason",modelValue:u.value,"onUpdate:modelValue":v[0]||(v[0]=g=>u.value=g),placeholder:"Explica el motivo del baneo...",rows:"4",state:h.value},null,8,["modelValue","state"]),a(E(ta),{state:h.value},{default:s(()=>[...v[5]||(v[5]=[S(" El motivo del baneo es obligatorio ",-1)])]),_:1},8,["state"])]),_:1})])]),_:1},8,["modelValue"]))}}),_o=ue(mo,[["__scopeId","data-v-6080150a"]]),vo={class:"user-groups-gamer"},fo={key:0,class:"header-container d-flex justify-content-between align-items-center my-3"},go={class:"page-title text-white"},ho={class:"profile-section"},yo=["src","alt"],bo={key:1,class:"avatar-placeholder"},ko={class:"edit-profile-btn"},wo={key:0,class:"profile-info"},Io={class:"profile-name"},$o={class:"profile-email"},Co={key:1,class:"header-container my-2"},Uo={class:"header-content"},Vo={class:"page-title"},Bo={class:"groups-grid"},zo={class:"group-card-gamer no-group-card"},Eo={class:"card-header-gamer"},Go={class:"header-content"},So={class:"users-grid"},Do=["draggable","onDragstart","onClick"],xo={class:"user-avatar-mini"},Mo=["src","alt"],Po={key:1,class:"avatar-placeholder-mini"},Fo={class:"user-name-mini"},No={key:0,class:"empty-state"},To={key:0,class:"group-card-gamer my-group-card"},Ao={class:"card-header-gamer"},Oo={class:"header-content"},Lo={class:"group-avatar"},Ho=["src","alt"],jo={class:"users-grid"},qo=["onClick"],Ro={class:"user-avatar-mini"},Wo=["src","alt"],Xo={key:1,class:"avatar-placeholder-mini"},Jo={class:"user-name-mini"},Ko=["onDrop"],Qo=["onClick"],Yo={class:"card-header-gamer"},Zo={class:"header-content"},et={class:"group-avatar"},at=["src","alt"],ot={class:"header-actions"},tt={class:"users-grid"},st=["draggable","onDragstart","onClick"],lt={class:"user-avatar-mini"},nt=["src","alt"],rt={key:1,class:"avatar-placeholder-mini"},it={class:"user-name-mini"},ut=["onClick"],dt={key:0,class:"empty-state"},ct={class:"group-card-gamer banned-card"},pt={class:"card-header-gamer"},mt={class:"header-content"},_t={class:"users-grid"},vt=["onClick"],ft={class:"user-avatar-mini"},gt=["src","alt"],ht={key:1,class:"avatar-placeholder-mini"},yt={class:"user-name-mini"},bt=["onClick"],kt={key:0,class:"empty-state"},wt=le({__name:"Groups",setup(V){const G=De(),l=T(()=>G.user),c=Pe,u=w([]),h=Ze({}),y=w([]),t=w([]),I=w(!1),p=w(null),v=w(!1),{toast:g,confirm:B}=xe(),x=T(()=>G.canModerate),b=w(!1),P=w(null),A=w({name:"",group_img_url:""}),F=w(null),O=w(!1),L=w(null),H=w(null),M=T(()=>l.value?.group_id?u.value.find(m=>m.id===l.value?.group_id)??null:null),X=T(()=>l.value?.group_id?u.value.filter(m=>m.id!==l.value?.group_id):u.value);Ce(()=>{j()});async function j(){try{Ee();const r=await c.getAllGroups();y.value=r.users_without_group||[],t.value=r.users_banned||[],u.value=r.groups_with_users.map($=>({id:$.id,name:$.name,group_img_url:$.group_img_url||null,users:$.users})),Object.keys(h).forEach($=>delete h[parseInt($)]),u.value.forEach($=>{$&&$.id&&(h[$.id]=!!$.group_img_url)})}catch{u.value=[],y.value=[],t.value=[]}finally{Ge()}}function _(m){m?.id&&(h[m.id]=!1)}function i(m){console.log(m),p.value=m,I.value=!0}function Q(){I.value=!1,p.value=null}function J(){G.fetchUser()}function ne(m,r){F.value={user:m,fromGroupId:r}}async function ge(m){if(!F.value||m===F.value.fromGroupId)return;const{user:r}=F.value;try{await te.assignUser(m,r.id),j(),g("Usuario movido exitosamente","success"),F.value=null}catch{g("Error al mover usuario","error")}}function K(m,r){const $=u.value.find(N=>N.id===r)?.users?.find(N=>N.id===m);$&&(L.value=$,H.value=r,O.value=!0)}async function he({userId:m,groupId:r,banReason:$}){try{await te.removeUser(r,m,$),O.value=!1,L.value=null,H.value=null,j(),g("Usuario baneado exitosamente","success")}catch{g("Error al banear usuario","error")}}async function ye(m){if((await B("Desbanear Usuario?","¿Estás seguro de desbanear este usuario?","Sí, Desbanear","Cancelar")).isConfirmed)try{await te.unbanUser(m),j(),g("Usuario desbaneado exitosamente","success")}catch{g("Error al desbanear usuario","error")}}function q(m){P.value=m,A.value={name:m.name,group_img_url:m.group_img_url||""},b.value=!0}function R(){P.value=null,A.value={name:"",group_img_url:""},b.value=!0}async function W(m){if((await B("Eliminar Grupo?","¿Deseas eliminar el grupo? Antes de eso te recomiendo quitar a los usuarios.","Sí, Eliminar","Cancelar")).isConfirmed)try{await te.destroy(m),g("Grupo eliminado exitosamente","success"),j()}catch{g("Error al eliminar grupo","error")}}return(m,r)=>{const $=f("IconUsersGroup"),N=f("IconUser"),de=f("IconEdit"),ce=f("IconPlus"),Y=ie,pe=f("IconUserOff"),Z=ra,ee=f("IconMoodEmpty"),me=f("IconFolder"),be=f("IconTrash"),ke=f("IconX"),we=f("IconBan"),k=f("IconUserCheck"),re=Ne;return o(),d("div",vo,[!x.value&&l.value.role_id!==3?(o(),d("div",fo,[e("h1",go,[a($,{size:32}),r[7]||(r[7]=S(" Grupos ",-1))]),e("div",ho,[e("div",{class:"profile-avatar",onClick:r[0]||(r[0]=n=>v.value=!0)},[l.value?.photo_url&&l.value?.photo_status==="approved"?(o(),d("img",{key:0,src:l.value.photo_url,alt:l.value.name},null,8,yo)):(o(),d("div",bo,[a(N,{size:32})])),e("button",ko,[a(de,{size:16})])]),l.value?(o(),d("div",wo,[e("p",Io,U(l.value.name),1),e("p",$o,U(l.value.email),1)])):z("",!0)])])):l.value.role_id!==3?(o(),d("div",Co,[e("div",Uo,[e("h1",Vo,[a($,{size:32}),r[8]||(r[8]=S(" Gestión de Grupos ",-1))]),a(Y,{variant:"primary",class:"btn-create-group ms-auto align-self-start",onClick:R},{default:s(()=>[a(ce,{size:20}),r[9]||(r[9]=e("span",null,"Crear Grupo",-1))]),_:1})])])):z("",!0),e("div",Bo,[e("div",zo,[e("div",Eo,[e("div",Go,[a(pe,{size:24}),r[10]||(r[10]=e("h3",null,"Sin Grupo",-1))]),a(Z,{variant:"warning",class:"user-count-badge"},{default:s(()=>[S(U(y.value.length),1)]),_:1})]),e("div",So,[(o(!0),d(oe,null,ae(y.value,n=>(o(),d("div",{key:n.id,class:"user-card-mini",draggable:x.value,onDragstart:D=>ne(n,null),onClick:D=>i(n)},[e("div",xo,[n.photo_url&&n.photo_status==="approved"?(o(),d("img",{key:0,src:n.photo_url,alt:n.name},null,8,Mo)):(o(),d("div",Po,[a(N,{size:20})]))]),e("span",Fo,U(n.name),1)],40,Do))),128)),y.value.length===0?(o(),d("div",No,[a(ee,{size:48}),r[11]||(r[11]=e("p",null,"Todos asignados",-1))])):z("",!0)])]),M.value?(o(),d("div",To,[M.value.group_img_url?(o(),d("div",{key:0,class:$e(["group-cover",{"cover-hidden":!h[M.value.id]}]),style:ze({backgroundImage:`url(${M.value.group_img_url})`}),onClick:r[1]||(r[1]=n=>_(M.value))},null,6)):z("",!0),e("div",Ao,[e("div",Oo,[e("div",Lo,[M.value.group_img_url?(o(),d("img",{key:0,src:M.value.group_img_url,alt:M.value.name},null,8,Ho)):(o(),C(me,{key:1,size:24}))]),e("h3",null,U(M.value.name),1)]),a(Z,{variant:"success",class:"my-group-badge"},{default:s(()=>[...r[12]||(r[12]=[S(" Mi Grupo ",-1)])]),_:1})]),e("div",jo,[(o(!0),d(oe,null,ae(M.value.users,n=>(o(),d("div",{key:n.id,class:"user-card-mini",onClick:D=>i(n)},[e("div",Ro,[n.photo_url&&n.photo_status==="approved"?(o(),d("img",{key:0,src:n.photo_url,alt:n.name},null,8,Wo)):(o(),d("div",Xo,[a(N,{size:20})]))]),e("span",Jo,U(n.name),1)],8,qo))),128))])])):z("",!0),(o(!0),d(oe,null,ae(X.value,n=>(o(),d("div",{key:n.id,class:"group-card-gamer",onDragover:r[2]||(r[2]=ve(()=>{},["prevent"])),onDrop:D=>ge(n.id)},[n.group_img_url?(o(),d("div",{key:0,class:$e(["group-cover",{"cover-hidden":!h[n.id]}]),style:ze({backgroundImage:`url(${n.group_img_url})`}),onClick:D=>_(n)},null,14,Qo)):z("",!0),e("div",Yo,[e("div",Zo,[e("div",et,[n.group_img_url?(o(),d("img",{key:0,src:n.group_img_url,alt:n.name},null,8,at)):(o(),C(me,{key:1,size:24}))]),e("h3",null,U(n.name),1)]),e("div",ot,[a(Z,{variant:"info",class:"user-count-badge"},{default:s(()=>[S(U(n.users?.length||0),1)]),_:2},1024),x.value?_e((o(),C(Y,{key:0,variant:"outline-light",size:"sm",class:"btn-icon-gamer",onClick:D=>q(n)},{default:s(()=>[a(de,{size:16})]),_:1},8,["onClick"])),[[re,"Editar grupo",void 0,{hover:!0,top:!0}]]):z("",!0),x.value?_e((o(),C(Y,{key:1,variant:"outline-danger",size:"sm",class:"btn-icon-gamer",onClick:D=>W(n.id)},{default:s(()=>[a(be,{size:16})]),_:1},8,["onClick"])),[[re,"Eliminar grupo",void 0,{hover:!0,top:!0}]]):z("",!0)])]),e("div",tt,[(o(!0),d(oe,null,ae(n.users,D=>(o(),d("div",{key:D.id,class:"user-card-mini",draggable:x.value,onDragstart:Ve=>ne(D,n.id),onClick:Ve=>i(D)},[e("div",lt,[D.photo_url&&D.photo_status==="approved"?(o(),d("img",{key:0,src:D.photo_url,alt:D.name},null,8,nt)):(o(),d("div",rt,[a(N,{size:20})]))]),e("span",it,U(D.name),1),x.value?_e((o(),d("button",{key:0,class:"btn-remove-user",onClick:ve(Ve=>K(D.id,n.id),["stop"])},[a(ke,{size:14})],8,ut)),[[re,"Remover del grupo",void 0,{hover:!0,top:!0}]]):z("",!0)],40,st))),128)),!n.users||n.users.length===0?(o(),d("div",dt,[a(ee,{size:48}),r[13]||(r[13]=e("p",null,"Sin miembros",-1))])):z("",!0)])],40,Ko))),128)),e("div",ct,[e("div",pt,[e("div",mt,[a(we,{size:24}),r[14]||(r[14]=e("h3",null,"Baneados",-1))]),a(Z,{variant:"danger",class:"user-count-badge"},{default:s(()=>[S(U(t.value.length),1)]),_:1})]),e("div",_t,[(o(!0),d(oe,null,ae(t.value,n=>(o(),d("div",{key:n.id,class:"user-card-mini banned-user",onClick:D=>i(n)},[e("div",ft,[n.photo_url&&n.photo_status==="approved"?(o(),d("img",{key:0,src:n.photo_url,alt:n.name},null,8,gt)):(o(),d("div",ht,[a(N,{size:20})]))]),e("span",yt,U(n.name),1),x.value?_e((o(),d("button",{key:0,class:"btn-unban-user",onClick:ve(D=>ye(n.id),["stop"])},[a(k,{size:14})],8,bt)),[[re,"Desbanear usuario",void 0,{hover:!0,top:!0}]]):z("",!0)],8,vt))),128)),t.value.length===0?(o(),d("div",kt,[a(ee,{size:48}),r[15]||(r[15]=e("p",null,"No hay usuarios baneados",-1))])):z("",!0)])])]),p.value?(o(),C(La,{key:2,modelValue:I.value,"onUpdate:modelValue":r[3]||(r[3]=n=>I.value=n),user:p.value,onClose:Q},null,8,["modelValue","user"])):z("",!0),a(so,{modelValue:v.value,"onUpdate:modelValue":r[4]||(r[4]=n=>v.value=n),user:l.value,onUpdated:J},null,8,["modelValue","user"]),a(ro,{modelValue:b.value,"onUpdate:modelValue":r[5]||(r[5]=n=>b.value=n),initialGroup:P.value,onSaved:j},null,8,["modelValue","initialGroup"]),L.value&&H.value?(o(),C(_o,{key:3,modelValue:O.value,"onUpdate:modelValue":r[6]||(r[6]=n=>O.value=n),user:L.value,"group-id":H.value,onBan:he},null,8,["modelValue","user","group-id"])):z("",!0)])}}}),St=ue(wt,[["__scopeId","data-v-aae6dfce"]]);export{St as default};
