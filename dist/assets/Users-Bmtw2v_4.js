import{_ as X,a as oe,v as Pe}from"./BFormTextarea.vue_vue_type_script_setup_true_lang-DB0GbEW7-rWVll0oD.js";import{a as $e,_ as Ee}from"./BCard.vue_vue_type_script_setup_true_lang-BjoxuViz-DGy1sf2k.js";import{M as Ae,_ as Re,a as Se,I as Fe,b as De}from"./ImagePreview-DFTYAaJd.js";import{_ as se,d as Te,a as Me,b as Ne}from"./BFormInput.vue_vue_type_script_setup_true_lang-D3z3jxbI-FC7C4P_5.js";import{_ as W,a as qe,b as Xe}from"./BInputGroupText.vue_vue_type_script_setup_true_lang-BBN5F0A4-BuOY8v3i.js";import{u as We}from"./table.fields-D5F4tg7_.js";import{n as B,l as D,y as T,r as h,z as G,A as M,f as b,w as s,b as t,o as i,m as Ge,c as x,d as $,a as U,g as E,h as Oe,B as C,F as Le,j as ee,t as A,C as ae,q as te,_ as Qe}from"./index-COsPQxU0.js";import{a as He,r as Je}from"./usePreloader-ddf6uGKr.js";const P={async getUsersByTab(r){const o={tab:r.tab};return r.per_page&&(o.per_page=r.per_page),r.page&&(o.page=r.page),r.search&&(o.search=r.search),(await B.post("/api/users/by-tab",o)).data},async getCounters(){return(await B.get("/api/users/counters")).data},async approvePhoto(r){const o={user_id:r};await B.post("/api/users/approve-photo",o)},async rejectPhoto(r,o){const p={user_id:r,reason:o};await B.post("/api/users/reject-photo",p)},async approveUser(r){const o={user_id:r};await B.post("/api/users/approve-account",o)},async rejectUser(r,o){const p={user_id:r,reason:o};await B.post("/api/users/reject-account",p)},async approveUserWithPhoto(r){const o={user_id:r};await B.post("/api/users/approve-with-photo",o)},async approveUserWithoutPhoto(r){const o={user_id:r};await B.post("/api/users/approve-without-photo",o)},async updateUser(r,o){const p={user_id:r,...o};await B.post("/api/users/update",p)},async deleteUser(r){const o={user_id:r};await B.post("/api/users/delete",o)}},Ke=D({__name:"EditUserModal",props:{modelValue:{type:Boolean},user:{}},emits:["update:modelValue","refresh"],setup(r,{emit:o}){const{toast:p}=T(),v=r,_=o,n=h({name:"",email:"",password:""}),m=G({get:()=>v.modelValue,set:l=>_("update:modelValue",l)});M(()=>v.user,l=>{l&&(n.value={name:l.name,email:l.email,password:""})},{immediate:!0});const k=async()=>{if(v.user)try{const l={name:n.value.name,email:n.value.email};n.value.password&&(l.password=n.value.password),await P.updateUser(v.user.id,l),m.value=!1,p("Usuario actualizado exitosamente","success"),_("refresh")}catch(l){console.error("Error al actualizar usuario:",l),p("Error al actualizar usuario","error")}};return(l,u)=>{const V=se,y=W,g=X;return i(),b(g,{modelValue:m.value,"onUpdate:modelValue":u[3]||(u[3]=d=>m.value=d),title:"Editar Usuario",onOk:k},{default:s(()=>[t(y,{label:"Nombre:","label-for":"edit-name"},{default:s(()=>[t(V,{id:"edit-name",modelValue:n.value.name,"onUpdate:modelValue":u[0]||(u[0]=d=>n.value.name=d),required:""},null,8,["modelValue"])]),_:1}),t(y,{label:"Email:","label-for":"edit-email"},{default:s(()=>[t(V,{id:"edit-email",modelValue:n.value.email,"onUpdate:modelValue":u[1]||(u[1]=d=>n.value.email=d),type:"email",required:""},null,8,["modelValue"])]),_:1}),t(y,{label:"Nueva Contraseña:","label-for":"edit-password"},{default:s(()=>[t(V,{id:"edit-password",modelValue:n.value.password,"onUpdate:modelValue":u[2]||(u[2]=d=>n.value.password=d),type:"password",placeholder:"Dejar en blanco para no cambiar"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])}}}),Ye=D({__name:"RejectPhotoModal",props:{modelValue:{type:Boolean},user:{}},emits:["update:modelValue","refresh"],setup(r,{emit:o}){const{toast:p}=T(),v=r,_=o,n=h(""),m=G({get:()=>v.modelValue,set:l=>_("update:modelValue",l)});M(m,l=>{l&&(n.value="")});const k=async()=>{if(!v.user||!n.value.trim()){p("Debes especificar una razón para el rechazo","warning");return}try{await P.rejectPhoto(v.user.id,n.value),m.value=!1,p("Foto rechazada exitosamente","success"),_("refresh")}catch(l){console.error("Error al rechazar foto:",l),p("Error al rechazar foto","error")}};return(l,u)=>{const V=oe,y=W,g=X;return i(),b(g,{modelValue:m.value,"onUpdate:modelValue":u[1]||(u[1]=d=>m.value=d),title:"Rechazar Foto",onOk:k},{default:s(()=>[t(y,{label:"Razón del rechazo:","label-for":"reject-reason"},{default:s(()=>[t(V,{id:"reject-reason",modelValue:n.value,"onUpdate:modelValue":u[0]||(u[0]=d=>n.value=d),placeholder:"Especifica por qué se rechaza la foto...",rows:"4",required:""},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])}}}),Ze=D({__name:"RejectAccountModal",props:{modelValue:{type:Boolean},user:{}},emits:["update:modelValue","refresh"],setup(r,{emit:o}){const{toast:p}=T(),v=r,_=o,n=h(""),m=G({get:()=>v.modelValue,set:l=>_("update:modelValue",l)});M(m,l=>{l&&(n.value="")});const k=async()=>{if(!v.user||!n.value.trim()){p("Debes especificar una razón para el rechazo","warning");return}try{await P.rejectUser(v.user.id,n.value),m.value=!1,p("Cuenta rechazada exitosamente","success"),_("refresh")}catch(l){console.error("Error al rechazar cuenta:",l),p("Error al rechazar cuenta","error")}};return(l,u)=>{const V=oe,y=W,g=X;return i(),b(g,{modelValue:m.value,"onUpdate:modelValue":u[1]||(u[1]=d=>m.value=d),title:"Rechazar Cuenta",onOk:k},{default:s(()=>[t(y,{label:"Razón del rechazo:","label-for":"reject-account-reason"},{default:s(()=>[t(V,{id:"reject-account-reason",modelValue:n.value,"onUpdate:modelValue":u[0]||(u[0]=d=>n.value=d),placeholder:"Especifica por qué se rechaza la cuenta...",rows:"4",required:""},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])}}}),ea={class:"users-management-gamer"},aa={class:"mb-4"},ta={class:"text-center my-2"},oa={class:"d-flex align-items-center"},sa={class:"fw-bold"},ra={class:"text-muted"},na={key:0,class:"d-flex align-items-center justify-content-center gap-2"},la=["src","alt","title"],ia={class:"social-nickname"},ca={key:1,class:"text-muted small"},ua={class:"d-flex align-items-center justify-content-center gap-1"},da={class:"d-flex align-items-center justify-content-center gap-1"},pa={key:0,class:"d-flex gap-2 justify-content-center"},ma={key:1,class:"d-flex gap-2 justify-content-center"},va={key:2,class:"d-flex gap-2 justify-content-center"},_a={key:0,class:"d-flex gap-2 justify-content-center"},fa={key:1,class:"d-flex gap-2 justify-content-center"},ha={key:0,class:"text-center py-5 empty-state-users"},ba={key:1,class:"d-flex justify-content-between align-items-center mt-4"},ya={class:"pagination-info"},ga=D({__name:"Users",setup(r){const{toast:o,confirmDelete:p,confirm:v}=T(),_=h("activeUsers"),n=h(!1),m=h([]),k=h(""),l=h(!1),u=h(!1),V=h(!1),y=h(null),g=h(1),d=h(10),S=h(0),re=h(1),O=[{key:"activeUsers",label:"Usuarios Activos",icon:"IconUsers"},{key:"pendingPhotos",label:"Fotos Pendientes",icon:"IconPhoto"},{key:"rejectedUsers",label:"Usuarios Rechazados",icon:"IconUserX"},{key:"pendingApproval",label:"Pendientes de Aprobacion",icon:"IconUserCheck"}],L=h({activeUsers:0,pendingPhotos:0,rejectedUsers:0,pendingApproval:0}),I=async()=>{if(!n.value){n.value=!0;try{const e=O.findIndex(q=>q.key===_.value),c=e>=0?e+1:1,f=await P.getUsersByTab({tab:c,search:k.value,per_page:d.value,page:g.value});return m.value=f.data||[],S.value=f.total||0,g.value=f.current_page||1,re.value=f.last_page||1,m.value}catch(e){console.error("Error al cargar usuarios:",e),m.value=[],S.value=0}finally{n.value=!1}}},ne=e=>{g.value=typeof e=="string"?parseInt(e):e,I()},R=async()=>{try{const e=await P.getCounters();L.value=e}catch(e){console.error("Error al actualizar estadísticas:",e)}},Q=async e=>{if((await p(e.name)).isConfirmed)try{await P.deleteUser(e.id),await I(),await R(),o("Usuario eliminado exitosamente","success")}catch(f){console.error("Error al eliminar usuario:",f),o("Error al eliminar usuario","error")}},le=async e=>{if((await v("¿Aprobar foto?",`¿Deseas aprobar la foto de ${e.name}?`,"Sí, aprobar","Cancelar")).isConfirmed)try{await P.approvePhoto(e.id),await I(),await R(),o("Foto aprobada exitosamente","success")}catch(f){console.error("Error al aprobar foto:",f),o("Error al aprobar foto","error")}},ie=async e=>{if((await v("¿Aprobar cuenta?",`¿Deseas aprobar la cuenta de ${e.name}?`,"Sí, aprobar","Cancelar")).isConfirmed)try{await P.approveUser(e.id),await I(),await R(),o("Usuario aprobado exitosamente","success")}catch(f){console.error("Error al aprobar usuario:",f),o("Error al aprobar usuario","error")}},ce=async e=>{if((await v("¿Aprobar con foto?",`¿Deseas aprobar a ${e.name} con foto de perfil?`,"Sí, aprobar","Cancelar")).isConfirmed)try{await P.approveUserWithPhoto(e.id),await I(),await R(),o("Usuario aprobado con foto exitosamente","success")}catch(f){console.error("Error al aprobar usuario:",f),o("Error al aprobar usuario","error")}},H=async e=>{if((await v("¿Aprobar sin foto?",`¿Deseas aprobar a ${e.name} sin foto de perfil?`,"Sí, aprobar","Cancelar")).isConfirmed)try{await P.approveUserWithoutPhoto(e.id),await I(),await R(),o("Usuario aprobado sin foto exitosamente","success")}catch(f){console.error("Error al aprobar usuario:",f),o("Error al aprobar usuario","error")}},N=async()=>{k.value="",await I(),await R()},ue=e=>{switch(e){case"approved":return"success";case"pending":return"warning";case"rejected":return"danger";default:return"secondary"}},de=e=>{switch(e){case"approved":return"IconCircleCheck";case"pending":return"IconClock";case"rejected":return"IconCircleX";default:return"IconPhotoOff"}},pe=e=>{switch(e){case"approved":return"Foto Aprobada";case"pending":return"Foto Pendiente";case"rejected":return"Foto Rechazada";default:return"Sin foto"}},me=e=>{switch(e){case"approved":return"success";case"pending":return"warning";case"rejected":return"danger";default:return"secondary"}},ve=e=>{switch(e){case"approved":return"IconUserCheck";case"pending":return"IconClock";case"rejected":return"IconUserX";default:return"IconUser"}},_e=e=>{switch(e){case"approved":return"Cuenta Aprobada";case"pending":return"Cuenta Pendiente";case"rejected":return"Cuenta Rechazada";default:return"Desconocido"}},J=e=>e?new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}):"N/A",fe=e=>{y.value=e,l.value=!0},he=e=>{y.value=e,u.value=!0},K=e=>{y.value=e,V.value=!0};return Ge(async()=>{He();try{await I(),await R()}catch(e){console.error("Error en onMounted:",e)}finally{Je()}}),M(_,(e,c)=>{e!==c&&(k.value="",g.value=1,I())}),(e,c)=>{const f=se,q=$("IconSearch"),be=Xe,ye=qe,ge=Te,we=Re,Ce=Ne,Ue=$("IconEdit"),z=Me,Y=$("IconTrash"),F=$("IconCircleCheck"),ke=$("IconCircleX"),Z=$("IconUserX"),Ve=$("IconUserCheck"),ze=Se,xe=$("IconInbox"),Ie=De,je=Ee,Be=$e,w=Pe;return i(),x("div",ea,[t(Be,{"no-body":"",class:"gamer-card"},{default:s(()=>[t(je,{class:"gamer-card-body"},{default:s(()=>[U("div",aa,[t(Ae,{tabs:O,"selected-tab":_.value,stats:L.value,"onUpdate:selectedTab":c[0]||(c[0]=a=>_.value=a)},null,8,["selected-tab","stats"])]),t(we,{class:"mb-3"},{default:s(()=>[t(ge,{md:"6",class:"ms-auto"},{default:s(()=>[t(ye,null,{default:s(()=>[t(f,{modelValue:k.value,"onUpdate:modelValue":c[1]||(c[1]=a=>k.value=a),placeholder:"Buscar por nombre o email..."},null,8,["modelValue"]),t(be,null,{default:s(()=>[t(q,{size:18,style:{cursor:"pointer"},onClick:I})]),_:1})]),_:1})]),_:1})]),_:1}),t(ze,{items:m.value,fields:Oe(We),busy:n.value,hover:"",responsive:"",striped:""},{"table-busy":s(()=>[U("div",ta,[t(Ce,{class:"align-middle"}),c[6]||(c[6]=U("strong",{class:"ms-2"},"Cargando...",-1))])]),"cell(name)":s(a=>[U("div",oa,[t(Fe,{src:a.item.photo_url||void 0,alt:a.item.name,initial:a.item.name.charAt(0).toUpperCase(),size:40,class:"me-2"},null,8,["src","alt","initial"]),U("div",null,[U("div",sa,A(a.item.name),1),U("small",ra,A(a.item.email),1)])])]),"cell(birthdate)":s(a=>[ee(A(J(a.item.birthdate)),1)]),"cell(social_network)":s(a=>[a.item.social_network_name&&a.item.social_network_logo_url?(i(),x("div",na,[C(U("img",{src:a.item.social_network_logo_url,alt:a.item.social_network_name,class:"social-network-icon",title:a.item.social_network_name},null,8,la),[[w,void 0,void 0,{hover:!0}]]),U("span",ia,A(a.item.nickname),1)])):(i(),x("span",ca,"-"))]),"cell(photo_status)":s(a=>[U("div",ua,[C((i(),b(ae(de(a.item.photo_status)),{size:18,class:te("text-"+ue(a.item.photo_status)),title:pe(a.item.photo_status)},null,8,["class","title"])),[[w,void 0,void 0,{hover:!0}]])])]),"cell(account_status)":s(a=>[U("div",da,[C((i(),b(ae(ve(a.item.account_status)),{size:18,class:te("text-"+me(a.item.account_status)),title:_e(a.item.account_status)},null,8,["class","title"])),[[w,void 0,void 0,{hover:!0}]])])]),"cell(created_at)":s(a=>[ee(A(J(a.item.created_at)),1)]),"cell(actions)":s(a=>[_.value==="activeUsers"?(i(),x("div",pa,[C((i(),b(z,{variant:"outline-primary",size:"sm",onClick:j=>fe(a.item),title:"Editar usuario",class:"icon-btn"},{default:s(()=>[t(Ue,{size:16})]),_:1},8,["onClick"])),[[w,void 0,void 0,{hover:!0}]]),C((i(),b(z,{variant:"outline-danger",size:"sm",onClick:j=>Q(a.item),title:"Eliminar usuario",class:"icon-btn"},{default:s(()=>[t(Y,{size:16})]),_:1},8,["onClick"])),[[w,void 0,void 0,{hover:!0}]])])):E("",!0),_.value==="pendingPhotos"?(i(),x("div",ma,[a.item.photo_status==="pending"||a.item.photo_status==="rejected"?C((i(),b(z,{key:0,variant:"outline-success",size:"sm",onClick:j=>le(a.item),title:"Aprobar foto",class:"icon-btn"},{default:s(()=>[t(F,{size:16})]),_:1},8,["onClick"])),[[w,void 0,void 0,{hover:!0}]]):E("",!0),a.item.photo_status==="pending"?C((i(),b(z,{key:1,variant:"outline-danger",size:"sm",onClick:j=>he(a.item),title:"Rechazar foto",class:"icon-btn"},{default:s(()=>[t(ke,{size:16})]),_:1},8,["onClick"])),[[w,void 0,void 0,{hover:!0}]]):E("",!0)])):E("",!0),_.value==="rejectedUsers"?(i(),x("div",va,[C((i(),b(z,{variant:"outline-success",size:"sm",onClick:j=>ie(a.item),title:"Aprobar usuario",class:"icon-btn"},{default:s(()=>[t(F,{size:16})]),_:1},8,["onClick"])),[[w,void 0,void 0,{hover:!0}]]),C((i(),b(z,{variant:"outline-danger",size:"sm",onClick:j=>Q(a.item),title:"Eliminar usuario",class:"icon-btn"},{default:s(()=>[t(Y,{size:16})]),_:1},8,["onClick"])),[[w,void 0,void 0,{hover:!0}]])])):E("",!0),_.value==="pendingApproval"?(i(),x(Le,{key:3},[a.item.photo_url?(i(),x("div",fa,[C((i(),b(z,{variant:"outline-success",size:"sm",onClick:j=>ce(a.item),title:"Aprobar con foto",class:"icon-btn"},{default:s(()=>[t(F,{size:16})]),_:1},8,["onClick"])),[[w,void 0,void 0,{hover:!0}]]),C((i(),b(z,{variant:"outline-warning",size:"sm",onClick:j=>H(a.item),title:"Aprobar sin foto",class:"icon-btn"},{default:s(()=>[t(Ve,{size:16})]),_:1},8,["onClick"])),[[w,void 0,void 0,{hover:!0}]]),C((i(),b(z,{variant:"outline-danger",size:"sm",onClick:j=>K(a.item),title:"Rechazar usuario",class:"icon-btn"},{default:s(()=>[t(Z,{size:16})]),_:1},8,["onClick"])),[[w,void 0,void 0,{hover:!0}]])])):(i(),x("div",_a,[C((i(),b(z,{variant:"outline-success",size:"sm",onClick:j=>H(a.item),title:"Aprobar usuario",class:"icon-btn"},{default:s(()=>[t(F,{size:16})]),_:1},8,["onClick"])),[[w,void 0,void 0,{hover:!0}]]),C((i(),b(z,{variant:"outline-danger",size:"sm",onClick:j=>K(a.item),title:"Rechazar usuario",class:"icon-btn"},{default:s(()=>[t(Z,{size:16})]),_:1},8,["onClick"])),[[w,void 0,void 0,{hover:!0}]])]))],64)):E("",!0)]),_:1},8,["items","fields","busy"]),!n.value&&m.value.length===0?(i(),x("div",ha,[t(xe,{size:64,class:"empty-icon"}),c[7]||(c[7]=U("p",{class:"empty-text mt-3"},"No hay usuarios para mostrar",-1))])):E("",!0),S.value>d.value?(i(),x("div",ba,[U("div",ya," Mostrando "+A((g.value-1)*d.value+1)+" - "+A(Math.min(g.value*d.value,S.value))+" de "+A(S.value)+" usuarios ",1),t(Ie,{modelValue:g.value,"onUpdate:modelValue":[c[2]||(c[2]=a=>g.value=a),ne],"total-rows":S.value,"per-page":d.value,align:"end",size:"sm",class:"mb-0"},null,8,["modelValue","total-rows","per-page"])])):E("",!0)]),_:1})]),_:1}),t(Ke,{modelValue:l.value,"onUpdate:modelValue":c[3]||(c[3]=a=>l.value=a),user:y.value,onRefresh:N},null,8,["modelValue","user"]),t(Ye,{modelValue:u.value,"onUpdate:modelValue":c[4]||(c[4]=a=>u.value=a),user:y.value,onRefresh:N},null,8,["modelValue","user"]),t(Ze,{modelValue:V.value,"onUpdate:modelValue":c[5]||(c[5]=a=>V.value=a),user:y.value,onRefresh:N},null,8,["modelValue","user"])])}}}),ja=Qe(ga,[["__scopeId","data-v-7497cdea"]]);export{ja as default};
