import{a as te,_ as se}from"./BCard.vue_vue_type_script_setup_true_lang-BjoxuViz-BXXky_ep.js";import{l as re,r as m,m as ie,n as ue,c as h,b as a,w as l,o as s,a as r,d as i,e as ce,f as u,g as b,j as d,t as I,h as de,F as me,p as pe,q as _e,v as fe,k as ve,x as P,_ as be}from"./index-Ddq0Vmzr.js";import{_ as ye,a as ge}from"./BForm.vue_vue_type_script_setup_true_lang-u44ElAm9-Bd6iVmq8.js";import{_ as ke,a as we}from"./BFormInput.vue_vue_type_script_setup_true_lang-D3z3jxbI-jXeus3ps.js";import{_ as Ce,a as Ie,b as Ve}from"./BInputGroupText.vue_vue_type_script_setup_true_lang-BBN5F0A4-D3v2PW3g.js";import{_ as he,a as xe}from"./useShowHide-717t6y_D-DsBGObqe.js";import{C as Se,e as ze}from"./es-B4xRyWDV.js";import{C as $e}from"./CountrySelect-CRVhwjb2.js";const Ue={class:"register-container"},Ee={class:"text-center mb-4"},Ne={class:"register-icon mb-3"},Te={class:"text-center mb-4"},qe={class:"photo-preview mx-auto mb-3"},Fe=["src"],Pe={key:1,class:"preview-placeholder"},De={class:"d-flex gap-2 justify-content-center"},Le={class:"social-network-selector"},Me=["onClick"],Oe=["src","alt"],Re={class:"social-name"},je={class:"text-center"},Ae={class:"text-muted mb-0"},Be=re({__name:"RegisterView",setup(Ye){const R=ve(),o=m({name:"",email:"",password:"",password_confirmation:"",birthdate:"",social_network_id:null,nickname:"",country:null,country_slug:null}),T=m([]),y=m(null),x=m(null),w=m(!1),g=m(!1),c=m(null),S=m(null),z=m(!1),$=m(!1),j={dateFormat:"Y-m-d",maxDate:"today",locale:ze.Spanish,allowInput:!0};ie(async()=>{try{const t=await ue.get("/api/social-networks");T.value=t.data}catch(t){console.error("Error al cargar redes sociales:",t)}});function A(t){o.value.social_network_id===t?(o.value.social_network_id=null,o.value.nickname=""):o.value.social_network_id=t}function B(){return T.value.find(e=>e.id===o.value.social_network_id)?.name||"la red social"}function Y(){x.value?.click()}async function Q(t){const p=t.target.files?.[0];if(p){if(!p.type.startsWith("image/")){c.value="Solo se permiten archivos de imagen";return}if(p.size>5*1024*1024){c.value="La imagen no debe superar los 5MB";return}await W(p)}}async function W(t){g.value=!0,c.value=null;try{const e=await fe.getSignature("user_photos"),{signature:p,timestamp:q,api_key:U,cloud_name:F,folder:k}=e.data,_=new FormData;_.append("file",t),_.append("api_key",U),_.append("timestamp",q.toString()),_.append("signature",p),_.append("folder",k);const E=await fetch(`https://api.cloudinary.com/v1_1/${F}/image/upload`,{method:"POST",body:_});if(!E.ok)throw new Error("Error al subir la imagen");const f=await E.json();y.value=f.secure_url}catch(e){c.value=e.message||"Error al subir la imagen a Cloudinary",console.error("Cloudinary upload error:",e)}finally{g.value=!1}}function G(){y.value=null,x.value&&(x.value.value="")}async function H(){if(c.value=null,S.value=null,o.value.password!==o.value.password_confirmation){c.value="Las contraseñas no coinciden";return}w.value=!0;try{await P.csrf(),await P.csrf();const t={...o.value,photo_url:y.value||void 0};o.value.social_network_id||(delete t.social_network_id,delete t.nickname),await P.register(t),S.value="✅ Cuenta creada exitosamente. Tu solicitud está pendiente de aprobación por un administrador.",o.value={name:"",email:"",password:"",password_confirmation:"",birthdate:"",social_network_id:null,nickname:"",country:null,country_slug:null},y.value=null,setTimeout(()=>{R.push("/login")},3e3)}catch(t){if(t.response?.data?.errors){const e=t.response.data.errors;c.value=Object.values(e).flat().join(", ")}else c.value=t.response?.data?.message||"Error al crear la cuenta"}finally{w.value=!1}}return(t,e)=>{const p=i("IconUserPlus"),q=i("IconCamera"),U=xe,F=i("IconUpload"),k=he,_=i("IconTrash"),E=i("IconUser"),f=Ve,V=ke,C=Ie,v=Ce,J=i("IconMail"),K=i("IconCalendar"),N=we,X=i("IconAt"),D=i("IconLock"),L=i("IconEye"),M=i("IconEyeOff"),Z=i("IconAlertCircle"),O=ge,ee=i("IconCheck"),ae=i("router-link"),le=ye,oe=se,ne=te;return s(),h("div",Ue,[a(ne,{class:"register-card shadow-lg"},{default:l(()=>[a(oe,{class:"p-4"},{default:l(()=>[r("div",Ee,[r("div",Ne,[a(p,{size:60,"stroke-width":1.5})]),e[11]||(e[11]=r("h2",{class:"fw-bold"},"Crear Cuenta",-1)),e[12]||(e[12]=r("p",{class:"text-muted"},"Completa el formulario para registrarte",-1))]),a(le,{onSubmit:ce(H,["prevent"])},{default:l(()=>[r("div",Te,[r("div",qe,[y.value?(s(),h("img",{key:0,src:y.value,alt:"Preview",class:"preview-image"},null,8,Fe)):(s(),h("div",Pe,[a(q,{size:40}),e[13]||(e[13]=r("p",{class:"mb-0 mt-2 small text-muted"},"Sin foto",-1))]))]),r("input",{type:"file",ref_key:"fileInput",ref:x,onChange:Q,accept:"image/*",class:"d-none"},null,544),r("div",De,[a(k,{variant:"outline-primary",size:"sm",onClick:Y,disabled:g.value},{default:l(()=>[g.value?(s(),u(U,{key:0,small:"",class:"me-2"})):b("",!0),g.value?b("",!0):(s(),u(F,{key:1,size:18,class:"me-1"})),d(" "+I(g.value?"Subiendo...":"Seleccionar Foto"),1)]),_:1},8,["disabled"]),y.value?(s(),u(k,{key:0,variant:"outline-danger",size:"sm",onClick:G},{default:l(()=>[a(_,{size:18,class:"me-1"}),e[14]||(e[14]=d(" Quitar ",-1))]),_:1})):b("",!0)])]),a(v,{label:"Nombre Completo","label-for":"name",class:"mb-3"},{default:l(()=>[a(C,null,{prepend:l(()=>[a(f,null,{default:l(()=>[a(E,{size:20})]),_:1})]),default:l(()=>[a(V,{id:"name",modelValue:o.value.name,"onUpdate:modelValue":e[0]||(e[0]=n=>o.value.name=n),type:"text",placeholder:"Tu nombre completo",required:""},null,8,["modelValue"])]),_:1})]),_:1}),a(v,{label:"Correo Electrónico","label-for":"email",class:"mb-3"},{default:l(()=>[a(C,null,{prepend:l(()=>[a(f,null,{default:l(()=>[a(J,{size:20})]),_:1})]),default:l(()=>[a(V,{id:"email",modelValue:o.value.email,"onUpdate:modelValue":e[1]||(e[1]=n=>o.value.email=n),type:"email",placeholder:"tu@email.com",required:""},null,8,["modelValue"])]),_:1})]),_:1}),a(v,{label:"Fecha de Nacimiento","label-for":"birthdate",class:"mb-3"},{default:l(()=>[a(C,null,{prepend:l(()=>[a(f,null,{default:l(()=>[a(K,{size:20})]),_:1})]),default:l(()=>[a(de(Se),{modelValue:o.value.birthdate,"onUpdate:modelValue":e[2]||(e[2]=n=>o.value.birthdate=n),config:j,class:"form-control",placeholder:"Selecciona tu fecha de nacimiento",required:""},null,8,["modelValue"])]),_:1})]),_:1}),a(v,{label:"Red Social (Opcional)","label-for":"social_network",class:"mb-3"},{default:l(()=>[r("div",Le,[(s(!0),h(me,null,pe(T.value,n=>(s(),h("div",{key:n.id,class:_e(["social-option",{active:o.value.social_network_id===n.id}]),onClick:Qe=>A(n.id)},[r("img",{src:n.logo_url,alt:n.name,class:"social-icon"},null,8,Oe),r("span",Re,I(n.name),1)],10,Me))),128))]),a(N,null,{default:l(()=>[...e[15]||(e[15]=[d("Selecciona dónde pueden encontrarte",-1)])]),_:1})]),_:1}),o.value.social_network_id?(s(),u(v,{key:0,label:"Nickname","label-for":"nickname",class:"mb-3"},{default:l(()=>[a(C,null,{prepend:l(()=>[a(f,null,{default:l(()=>[a(X,{size:20})]),_:1})]),default:l(()=>[a(V,{id:"nickname",modelValue:o.value.nickname,"onUpdate:modelValue":e[3]||(e[3]=n=>o.value.nickname=n),type:"text",placeholder:"Tu usuario en la red social",required:!!o.value.social_network_id},null,8,["modelValue","required"])]),_:1}),a(N,null,{default:l(()=>[d(" Tu nickname en "+I(B()),1)]),_:1})]),_:1})):b("",!0),a(v,{label:"País (Opcional)","label-for":"country",class:"mb-3"},{default:l(()=>[a($e,{modelValue:o.value.country,"onUpdate:modelValue":e[4]||(e[4]=n=>o.value.country=n),modelSlug:o.value.country_slug,"onUpdate:modelSlug":e[5]||(e[5]=n=>o.value.country_slug=n)},null,8,["modelValue","modelSlug"]),a(N,null,{default:l(()=>[...e[16]||(e[16]=[d("Tu país es opcional y se enviará al backend si lo seleccionas",-1)])]),_:1})]),_:1}),a(v,{label:"Contraseña","label-for":"password",class:"mb-3"},{default:l(()=>[a(C,null,{prepend:l(()=>[a(f,null,{default:l(()=>[a(D,{size:20})]),_:1})]),append:l(()=>[a(k,{variant:"outline-secondary",onClick:e[7]||(e[7]=n=>z.value=!z.value)},{default:l(()=>[z.value?(s(),u(M,{key:1,size:20})):(s(),u(L,{key:0,size:20}))]),_:1})]),default:l(()=>[a(V,{id:"password",modelValue:o.value.password,"onUpdate:modelValue":e[6]||(e[6]=n=>o.value.password=n),type:z.value?"text":"password",placeholder:"Mínimo 8 caracteres",required:"",minlength:"8"},null,8,["modelValue","type"])]),_:1}),a(N,null,{default:l(()=>[...e[17]||(e[17]=[d("La contraseña debe tener al menos 8 caracteres",-1)])]),_:1})]),_:1}),a(v,{label:"Confirmar Contraseña","label-for":"password_confirmation",class:"mb-3"},{default:l(()=>[a(C,null,{prepend:l(()=>[a(f,null,{default:l(()=>[a(D,{size:20})]),_:1})]),append:l(()=>[a(k,{variant:"outline-secondary",onClick:e[9]||(e[9]=n=>$.value=!$.value)},{default:l(()=>[$.value?(s(),u(M,{key:1,size:20})):(s(),u(L,{key:0,size:20}))]),_:1})]),default:l(()=>[a(V,{id:"password_confirmation",modelValue:o.value.password_confirmation,"onUpdate:modelValue":e[8]||(e[8]=n=>o.value.password_confirmation=n),type:$.value?"text":"password",placeholder:"Repite tu contraseña",required:"",minlength:"8"},null,8,["modelValue","type"])]),_:1})]),_:1}),c.value?(s(),u(O,{key:1,variant:"danger",show:"",dismissible:"",onDismissed:e[10]||(e[10]=n=>c.value=null),class:"mb-3"},{default:l(()=>[a(Z,{size:20,class:"me-2"}),d(" "+I(c.value),1)]),_:1})):b("",!0),S.value?(s(),u(O,{key:2,variant:"success",show:"",class:"mb-3"},{default:l(()=>[a(ee,{size:20,class:"me-2"}),d(" "+I(S.value),1)]),_:1})):b("",!0),a(k,{type:"submit",variant:"primary",size:"lg",class:"w-100 mb-3",disabled:w.value||g.value},{default:l(()=>[w.value?(s(),u(U,{key:0,small:"",class:"me-2"})):b("",!0),w.value?b("",!0):(s(),u(p,{key:1,size:20,class:"me-2"})),d(" "+I(w.value?"Creando cuenta...":"Crear Cuenta"),1)]),_:1},8,["disabled"]),r("div",je,[r("p",Ae,[e[19]||(e[19]=d(" ¿Ya tienes cuenta? ",-1)),a(ae,{to:"/login",class:"text-decoration-none fw-semibold"},{default:l(()=>[...e[18]||(e[18]=[d(" Inicia Sesión ",-1)])]),_:1})])])]),_:1})]),_:1})]),_:1})])}}}),aa=be(Be,[["__scopeId","data-v-c7ef7b41"]]);export{aa as default};
