import{_ as ae,v as Pe}from"./BFormTextarea.vue_vue_type_script_setup_true_lang-DB0GbEW7-zQ7uLZyc.js";import{a as Ee,_ as $e}from"./BCard.vue_vue_type_script_setup_true_lang-BjoxuViz-BXXky_ep.js";import{M as Ae,_ as Re,a as Fe,I as Se,b as De}from"./ImagePreview-sipDSbfw.js";import{_ as Te,a as Me}from"./useShowHide-717t6y_D-DsBGObqe.js";import{_ as oe,b as Ne}from"./BFormInput.vue_vue_type_script_setup_true_lang-D3z3jxbI-jXeus3ps.js";import{_ as q,a as qe,b as Xe}from"./BInputGroupText.vue_vue_type_script_setup_true_lang-BBN5F0A4-D3v2PW3g.js";import{n as B,l as D,y as T,r as f,z as X,A as M,f as h,w as s,b as a,o as c,m as We,c as x,a as k,g as E,d as $,h as Ge,B as w,F as Oe,j as Z,t as A,q as ee,C as te,_ as Le}from"./index-Ddq0Vmzr.js";import{_ as W,a as Qe,r as He}from"./usePreloader-DvikwN0v.js";const Je=[{key:"name",label:"Usuario",sortable:!0,visible:!0,thClass:"text-start",tdClass:"text-start"},{key:"birthdate",label:"Fecha Nacimiento",sortable:!0,visible:!0,thClass:"text-center",tdClass:"text-center"},{key:"social_network",label:"Red Social",sortable:!1,visible:!0,thClass:"text-center",tdClass:"text-center"},{key:"photo_status",label:"Estado Foto",sortable:!0,visible:!0,thClass:"text-center",tdClass:"text-center"},{key:"account_status",label:"Estado Cuenta",sortable:!0,visible:!0,thClass:"text-center",tdClass:"text-center"},{key:"created_at",label:"Fecha Registro",sortable:!0,visible:!0,thClass:"text-center",tdClass:"text-center"},{key:"actions",label:"Acciones",visible:!0,thClass:"text-center",tdClass:"text-center"}],P={async getUsersByTab(r){const o={tab:r.tab};return r.per_page&&(o.per_page=r.per_page),r.page&&(o.page=r.page),r.search&&(o.search=r.search),(await B.post("/api/users/by-tab",o)).data},async getCounters(){return(await B.get("/api/users/counters")).data},async approvePhoto(r){const o={user_id:r};await B.post("/api/users/approve-photo",o)},async rejectPhoto(r,o){const p={user_id:r,reason:o};await B.post("/api/users/reject-photo",p)},async approveUser(r){const o={user_id:r};await B.post("/api/users/approve-account",o)},async rejectUser(r,o){const p={user_id:r,reason:o};await B.post("/api/users/reject-account",p)},async approveUserWithPhoto(r){const o={user_id:r};await B.post("/api/users/approve-with-photo",o)},async approveUserWithoutPhoto(r){const o={user_id:r};await B.post("/api/users/approve-without-photo",o)},async updateUser(r,o){const p={user_id:r,...o};await B.post("/api/users/update",p)},async deleteUser(r){const o={user_id:r};await B.post("/api/users/delete",o)}},Ke=D({__name:"EditUserModal",props:{modelValue:{type:Boolean},user:{}},emits:["update:modelValue","refresh"],setup(r,{emit:o}){const{toast:p}=T(),v=r,_=o,n=f({name:"",email:"",password:""}),m=X({get:()=>v.modelValue,set:l=>_("update:modelValue",l)});M(()=>v.user,l=>{l&&(n.value={name:l.name,email:l.email,password:""})},{immediate:!0});const U=async()=>{if(v.user)try{const l={name:n.value.name,email:n.value.email};n.value.password&&(l.password=n.value.password),await P.updateUser(v.user.id,l),m.value=!1,p("Usuario actualizado exitosamente","success"),_("refresh")}catch(l){console.error("Error al actualizar usuario:",l),p("Error al actualizar usuario","error")}};return(l,u)=>{const V=oe,b=q,y=W;return c(),h(y,{modelValue:m.value,"onUpdate:modelValue":u[3]||(u[3]=d=>m.value=d),title:"Editar Usuario",onOk:U},{default:s(()=>[a(b,{label:"Nombre:","label-for":"edit-name"},{default:s(()=>[a(V,{id:"edit-name",modelValue:n.value.name,"onUpdate:modelValue":u[0]||(u[0]=d=>n.value.name=d),required:""},null,8,["modelValue"])]),_:1}),a(b,{label:"Email:","label-for":"edit-email"},{default:s(()=>[a(V,{id:"edit-email",modelValue:n.value.email,"onUpdate:modelValue":u[1]||(u[1]=d=>n.value.email=d),type:"email",required:""},null,8,["modelValue"])]),_:1}),a(b,{label:"Nueva Contraseña:","label-for":"edit-password"},{default:s(()=>[a(V,{id:"edit-password",modelValue:n.value.password,"onUpdate:modelValue":u[2]||(u[2]=d=>n.value.password=d),type:"password",placeholder:"Dejar en blanco para no cambiar"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])}}}),Ye=D({__name:"RejectPhotoModal",props:{modelValue:{type:Boolean},user:{}},emits:["update:modelValue","refresh"],setup(r,{emit:o}){const{toast:p}=T(),v=r,_=o,n=f(""),m=X({get:()=>v.modelValue,set:l=>_("update:modelValue",l)});M(m,l=>{l&&(n.value="")});const U=async()=>{if(!v.user||!n.value.trim()){p("Debes especificar una razón para el rechazo","warning");return}try{await P.rejectPhoto(v.user.id,n.value),m.value=!1,p("Foto rechazada exitosamente","success"),_("refresh")}catch(l){console.error("Error al rechazar foto:",l),p("Error al rechazar foto","error")}};return(l,u)=>{const V=ae,b=q,y=W;return c(),h(y,{modelValue:m.value,"onUpdate:modelValue":u[1]||(u[1]=d=>m.value=d),title:"Rechazar Foto",onOk:U},{default:s(()=>[a(b,{label:"Razón del rechazo:","label-for":"reject-reason"},{default:s(()=>[a(V,{id:"reject-reason",modelValue:n.value,"onUpdate:modelValue":u[0]||(u[0]=d=>n.value=d),placeholder:"Especifica por qué se rechaza la foto...",rows:"4",required:""},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])}}}),Ze=D({__name:"RejectAccountModal",props:{modelValue:{type:Boolean},user:{}},emits:["update:modelValue","refresh"],setup(r,{emit:o}){const{toast:p}=T(),v=r,_=o,n=f(""),m=X({get:()=>v.modelValue,set:l=>_("update:modelValue",l)});M(m,l=>{l&&(n.value="")});const U=async()=>{if(!v.user||!n.value.trim()){p("Debes especificar una razón para el rechazo","warning");return}try{await P.rejectUser(v.user.id,n.value),m.value=!1,p("Cuenta rechazada exitosamente","success"),_("refresh")}catch(l){console.error("Error al rechazar cuenta:",l),p("Error al rechazar cuenta","error")}};return(l,u)=>{const V=ae,b=q,y=W;return c(),h(y,{modelValue:m.value,"onUpdate:modelValue":u[1]||(u[1]=d=>m.value=d),title:"Rechazar Cuenta",onOk:U},{default:s(()=>[a(b,{label:"Razón del rechazo:","label-for":"reject-account-reason"},{default:s(()=>[a(V,{id:"reject-account-reason",modelValue:n.value,"onUpdate:modelValue":u[0]||(u[0]=d=>n.value=d),placeholder:"Especifica por qué se rechaza la cuenta...",rows:"4",required:""},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])}}}),et={class:"users-management-gamer"},tt={class:"mb-4"},at={class:"text-center my-2"},ot={class:"d-flex align-items-center"},st={class:"fw-bold"},rt={class:"text-muted"},nt={key:0,class:"d-flex align-items-center justify-content-center gap-2"},lt=["src","alt","title"],it={class:"social-nickname"},ct={key:1,class:"text-muted small"},ut={class:"d-flex align-items-center justify-content-center gap-1"},dt={class:"d-flex align-items-center justify-content-center gap-1"},pt={key:0,class:"d-flex gap-2 justify-content-center"},mt={key:1,class:"d-flex gap-2 justify-content-center"},vt={key:2,class:"d-flex gap-2 justify-content-center"},_t={key:0,class:"d-flex gap-2 justify-content-center"},ft={key:1,class:"d-flex gap-2 justify-content-center"},ht={key:0,class:"text-center py-5 empty-state-users"},bt={key:1,class:"d-flex justify-content-between align-items-center mt-4"},yt={class:"pagination-info"},gt=D({__name:"Users",setup(r){const{toast:o,confirmDelete:p,confirm:v}=T(),_=f("activeUsers"),n=f(!1),m=f([]),U=f(""),l=f(!1),u=f(!1),V=f(!1),b=f(null),y=f(1),d=f(10),F=f(0),se=f(1),G=[{key:"activeUsers",label:"Usuarios Activos",value:1,icon:"IconUsers"},{key:"pendingPhotos",label:"Fotos Pendientes",value:2,icon:"IconPhoto"},{key:"rejectedUsers",label:"Usuarios Rechazados",value:3,icon:"IconUserX"},{key:"pendingApproval",label:"Pendientes de Aprobacion",value:4,icon:"IconUserCheck"}],O=f({activeUsers:0,pendingPhotos:0,rejectedUsers:0,pendingApproval:0}),I=async()=>{if(!n.value){n.value=!0;try{const e=G.find(C=>C.key===_.value)?.value||1,i=await P.getUsersByTab({tab:e,search:U.value,per_page:d.value,page:y.value});return m.value=i.data||[],F.value=i.total||0,y.value=i.current_page||1,se.value=i.last_page||1,m.value}catch(e){console.error("Error al cargar usuarios:",e),m.value=[],F.value=0}finally{n.value=!1}}},re=e=>{y.value=typeof e=="string"?parseInt(e):e,I()},R=async()=>{try{const e=await P.getCounters();O.value=e}catch(e){console.error("Error al actualizar estadísticas:",e)}},L=async e=>{if((await p(e.name)).isConfirmed)try{await P.deleteUser(e.id),await I(),await R(),o("Usuario eliminado exitosamente","success")}catch(C){console.error("Error al eliminar usuario:",C),o("Error al eliminar usuario","error")}},ne=async e=>{if((await v("¿Aprobar foto?",`¿Deseas aprobar la foto de ${e.name}?`,"Sí, aprobar","Cancelar")).isConfirmed)try{await P.approvePhoto(e.id),await I(),await R(),o("Foto aprobada exitosamente","success")}catch(C){console.error("Error al aprobar foto:",C),o("Error al aprobar foto","error")}},le=async e=>{if((await v("¿Aprobar cuenta?",`¿Deseas aprobar la cuenta de ${e.name}?`,"Sí, aprobar","Cancelar")).isConfirmed)try{await P.approveUser(e.id),await I(),await R(),o("Usuario aprobado exitosamente","success")}catch(C){console.error("Error al aprobar usuario:",C),o("Error al aprobar usuario","error")}},ie=async e=>{if((await v("¿Aprobar con foto?",`¿Deseas aprobar a ${e.name} con foto de perfil?`,"Sí, aprobar","Cancelar")).isConfirmed)try{await P.approveUserWithPhoto(e.id),await I(),await R(),o("Usuario aprobado con foto exitosamente","success")}catch(C){console.error("Error al aprobar usuario:",C),o("Error al aprobar usuario","error")}},Q=async e=>{if((await v("¿Aprobar sin foto?",`¿Deseas aprobar a ${e.name} sin foto de perfil?`,"Sí, aprobar","Cancelar")).isConfirmed)try{await P.approveUserWithoutPhoto(e.id),await I(),await R(),o("Usuario aprobado sin foto exitosamente","success")}catch(C){console.error("Error al aprobar usuario:",C),o("Error al aprobar usuario","error")}},N=async()=>{U.value="",await I(),await R()},ce=e=>{switch(e){case"approved":return"success";case"pending":return"warning";case"rejected":return"danger";default:return"secondary"}},ue=e=>{switch(e){case"approved":return"IconCircleCheck";case"pending":return"IconClock";case"rejected":return"IconCircleX";default:return"IconPhotoOff"}},de=e=>{switch(e){case"approved":return"Foto Aprobada";case"pending":return"Foto Pendiente";case"rejected":return"Foto Rechazada";default:return"Sin foto"}},pe=e=>{switch(e){case"approved":return"success";case"pending":return"warning";case"rejected":return"danger";default:return"secondary"}},me=e=>{switch(e){case"approved":return"IconUserCheck";case"pending":return"IconClock";case"rejected":return"IconUserX";default:return"IconUser"}},ve=e=>{switch(e){case"approved":return"Cuenta Aprobada";case"pending":return"Cuenta Pendiente";case"rejected":return"Cuenta Rechazada";default:return"Desconocido"}},H=e=>e?new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}):"N/A",_e=e=>{b.value=e,l.value=!0},fe=e=>{b.value=e,u.value=!0},J=e=>{b.value=e,V.value=!0};return We(async()=>{Qe();try{await I(),await R()}catch(e){console.error("Error en onMounted:",e)}finally{He()}}),M(_,(e,i)=>{e!==i&&(U.value="",y.value=1,I())}),(e,i)=>{const C=oe,he=$("IconSearch"),be=Xe,ye=qe,ge=Ne,we=Re,Ce=Me,ke=$("IconEdit"),z=Te,K=$("IconTrash"),S=$("IconCircleCheck"),Ue=$("IconCircleX"),Y=$("IconUserX"),Ve=$("IconUserCheck"),ze=Fe,xe=$("IconInbox"),Ie=De,je=$e,Be=Ee,g=Pe;return c(),x("div",et,[a(Be,{"no-body":"",class:"gamer-card"},{default:s(()=>[a(je,{class:"gamer-card-body"},{default:s(()=>[k("div",tt,[a(Ae,{tabs:G,"selected-tab":_.value,stats:O.value,"onUpdate:selectedTab":i[0]||(i[0]=t=>_.value=t)},null,8,["selected-tab","stats"])]),a(we,{class:"mb-3"},{default:s(()=>[a(ge,{md:"6",class:"ms-auto"},{default:s(()=>[a(ye,null,{default:s(()=>[a(C,{modelValue:U.value,"onUpdate:modelValue":i[1]||(i[1]=t=>U.value=t),placeholder:"Buscar por nombre o email..."},null,8,["modelValue"]),a(be,null,{default:s(()=>[a(he,{size:18,style:{cursor:"pointer"},onClick:I})]),_:1})]),_:1})]),_:1})]),_:1}),a(ze,{items:m.value,fields:Ge(Je),busy:n.value,hover:"",responsive:"",striped:""},{"table-busy":s(()=>[k("div",at,[a(Ce,{class:"align-middle"}),i[6]||(i[6]=k("strong",{class:"ms-2"},"Cargando...",-1))])]),"cell(name)":s(t=>[k("div",ot,[a(Se,{src:t.item.photo_url||void 0,alt:t.item.name,initial:t.item.name.charAt(0).toUpperCase(),size:40,class:"me-2"},null,8,["src","alt","initial"]),k("div",null,[k("div",st,A(t.item.name),1),k("small",rt,A(t.item.email),1)])])]),"cell(birthdate)":s(t=>[Z(A(H(t.item.birthdate)),1)]),"cell(social_network)":s(t=>[t.item.social_network_name&&t.item.social_network_logo_url?(c(),x("div",nt,[w(k("img",{src:t.item.social_network_logo_url,alt:t.item.social_network_name,class:"social-network-icon",title:t.item.social_network_name},null,8,lt),[[g,void 0,void 0,{hover:!0}]]),k("span",it,A(t.item.nickname),1)])):(c(),x("span",ct,"-"))]),"cell(photo_status)":s(t=>[k("div",ut,[w((c(),h(te(ue(t.item.photo_status)),{size:18,class:ee("text-"+ce(t.item.photo_status)),title:de(t.item.photo_status)},null,8,["class","title"])),[[g,void 0,void 0,{hover:!0}]])])]),"cell(account_status)":s(t=>[k("div",dt,[w((c(),h(te(me(t.item.account_status)),{size:18,class:ee("text-"+pe(t.item.account_status)),title:ve(t.item.account_status)},null,8,["class","title"])),[[g,void 0,void 0,{hover:!0}]])])]),"cell(created_at)":s(t=>[Z(A(H(t.item.created_at)),1)]),"cell(actions)":s(t=>[_.value==="activeUsers"?(c(),x("div",pt,[w((c(),h(z,{variant:"outline-primary",size:"sm",onClick:j=>_e(t.item),title:"Editar usuario",class:"icon-btn"},{default:s(()=>[a(ke,{size:16})]),_:1},8,["onClick"])),[[g,void 0,void 0,{hover:!0}]]),w((c(),h(z,{variant:"outline-danger",size:"sm",onClick:j=>L(t.item),title:"Eliminar usuario",class:"icon-btn"},{default:s(()=>[a(K,{size:16})]),_:1},8,["onClick"])),[[g,void 0,void 0,{hover:!0}]])])):E("",!0),_.value==="pendingPhotos"?(c(),x("div",mt,[t.item.photo_status==="pending"||t.item.photo_status==="rejected"?w((c(),h(z,{key:0,variant:"outline-success",size:"sm",onClick:j=>ne(t.item),title:"Aprobar foto",class:"icon-btn"},{default:s(()=>[a(S,{size:16})]),_:1},8,["onClick"])),[[g,void 0,void 0,{hover:!0}]]):E("",!0),t.item.photo_status==="pending"?w((c(),h(z,{key:1,variant:"outline-danger",size:"sm",onClick:j=>fe(t.item),title:"Rechazar foto",class:"icon-btn"},{default:s(()=>[a(Ue,{size:16})]),_:1},8,["onClick"])),[[g,void 0,void 0,{hover:!0}]]):E("",!0)])):E("",!0),_.value==="rejectedUsers"?(c(),x("div",vt,[w((c(),h(z,{variant:"outline-success",size:"sm",onClick:j=>le(t.item),title:"Aprobar usuario",class:"icon-btn"},{default:s(()=>[a(S,{size:16})]),_:1},8,["onClick"])),[[g,void 0,void 0,{hover:!0}]]),w((c(),h(z,{variant:"outline-danger",size:"sm",onClick:j=>L(t.item),title:"Eliminar usuario",class:"icon-btn"},{default:s(()=>[a(K,{size:16})]),_:1},8,["onClick"])),[[g,void 0,void 0,{hover:!0}]])])):E("",!0),_.value==="pendingApproval"?(c(),x(Oe,{key:3},[t.item.photo_url?(c(),x("div",ft,[w((c(),h(z,{variant:"outline-success",size:"sm",onClick:j=>ie(t.item),title:"Aprobar con foto",class:"icon-btn"},{default:s(()=>[a(S,{size:16})]),_:1},8,["onClick"])),[[g,void 0,void 0,{hover:!0}]]),w((c(),h(z,{variant:"outline-warning",size:"sm",onClick:j=>Q(t.item),title:"Aprobar sin foto",class:"icon-btn"},{default:s(()=>[a(Ve,{size:16})]),_:1},8,["onClick"])),[[g,void 0,void 0,{hover:!0}]]),w((c(),h(z,{variant:"outline-danger",size:"sm",onClick:j=>J(t.item),title:"Rechazar usuario",class:"icon-btn"},{default:s(()=>[a(Y,{size:16})]),_:1},8,["onClick"])),[[g,void 0,void 0,{hover:!0}]])])):(c(),x("div",_t,[w((c(),h(z,{variant:"outline-success",size:"sm",onClick:j=>Q(t.item),title:"Aprobar usuario",class:"icon-btn"},{default:s(()=>[a(S,{size:16})]),_:1},8,["onClick"])),[[g,void 0,void 0,{hover:!0}]]),w((c(),h(z,{variant:"outline-danger",size:"sm",onClick:j=>J(t.item),title:"Rechazar usuario",class:"icon-btn"},{default:s(()=>[a(Y,{size:16})]),_:1},8,["onClick"])),[[g,void 0,void 0,{hover:!0}]])]))],64)):E("",!0)]),_:1},8,["items","fields","busy"]),!n.value&&m.value.length===0?(c(),x("div",ht,[a(xe,{size:64,class:"empty-icon"}),i[7]||(i[7]=k("p",{class:"empty-text mt-3"},"No hay usuarios para mostrar",-1))])):E("",!0),F.value>d.value?(c(),x("div",bt,[k("div",yt," Mostrando "+A((y.value-1)*d.value+1)+" - "+A(Math.min(y.value*d.value,F.value))+" de "+A(F.value)+" usuarios ",1),a(Ie,{modelValue:y.value,"onUpdate:modelValue":[i[2]||(i[2]=t=>y.value=t),re],"total-rows":F.value,"per-page":d.value,align:"end",size:"sm",class:"mb-0"},null,8,["modelValue","total-rows","per-page"])])):E("",!0)]),_:1})]),_:1}),a(Ke,{modelValue:l.value,"onUpdate:modelValue":i[3]||(i[3]=t=>l.value=t),user:b.value,onRefresh:N},null,8,["modelValue","user"]),a(Ye,{modelValue:u.value,"onUpdate:modelValue":i[4]||(i[4]=t=>u.value=t),user:b.value,onRefresh:N},null,8,["modelValue","user"]),a(Ze,{modelValue:V.value,"onUpdate:modelValue":i[5]||(i[5]=t=>V.value=t),user:b.value,onRefresh:N},null,8,["modelValue","user"])])}}}),jt=Le(gt,[["__scopeId","data-v-1b5c184d"]]);export{jt as default};
